services:
  ap_proxy:
    container_name: ap_proxy
    build: ./proxy
    tty: true
    restart: on-failure:5
  ap_webpilot:
    container_name: ap_webpilot
    depends_on:
      - ap_proxy
      - ap_postgres
    build: ./webpilot
    tty: true
    ports:
      - "58000:58000/tcp"
    restart: on-failure:5
  ap_postgres:
    container_name: ap_postgres
    image: postgres:14
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:
      - db_data:/var/lib/posrgresql/data
    ports:
      - "5432:5432/tcp"
    restart: on-failure:5
volumes:
  db_data: {}
